<!DOCTYPE html>
<html lang="ko">
{% load static %}
<head>
    <meta charset="UTF-8">
    <title>HN IDC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="icon" type="image/png" href="{% static 'img_v2/Link_96.png' %}">
    <link rel="stylesheet" href="{% static 'bootstrap/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'style_v3.css' %}">
    <link rel="stylesheet" href="{% static 'flatpickr/flatpickr.min.css' %}">
    <link rel="stylesheet" href="{% static 'django_ckeditor_5/dist/styles.css' %}">

    <style>
        /* 1. 기본 베이스 */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #f7f7f7;
            margin: 0;
            padding: 40px;
            transition: background 0.3s;
            overflow-x: hidden;
        }
    
        header { text-align: center; margin-bottom: 40px; }
        .subtitle { color: #aaa; font-style: italic; font-size: 0.9rem; }
    
        /* 2. ✅ 메인 레이아웃 (좌측 달력 / 우측 콘텐츠) */
        .main-container {
            display: flex;
            gap: 50px; 
            max-width: 100%;
            margin: 0 auto;
            align-items: flex-start;
        }
    
        /* ⬅️ 좌측 사이드바 (달력) */
        .side-panel {
            flex: 0 0 350px;
            position: sticky;
            top: 40px;
            z-index: 10;
        }
    
        .calendar-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            text-align: center;
        }
    
        /* ➡️ 우측 메인 패널 (공지 + 카드) */
        .content-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 40px;
            min-width: 0;
        }
    
        /* 3. 공지사항 섹션 */
        .notice-box {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #e0e0e0;
            min-height: 120px;
        }
        .notice-header { 
            font-weight: bold; 
            color: #2a72de; 
            margin-bottom: 20px; 
            font-size: 1.2rem; 
            display: flex; 
            align-items: center; 
            gap: 10px;
        }
    
        /* 4. ✅ 동적 카드 그리드 (5열 배치 최적화) */
        .cards-grid {
            display: grid;
            /* 화면 너비에 따라 250px 이상의 카드를 배치하되 최대 5열 */
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 30px;
        }
    
        @media (min-width: 1600px) {
            .cards-grid { grid-template-columns: repeat(5, 1fr); }
        }
    
        .card {
            background: white;
            border-radius: 12px;
            border: 1px solid #eef2f7;
            height: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .card-title { font-size: 1.1rem !important; font-weight: bold; padding: 15px !important; border-bottom: 1px solid #f0f0f0; }
    
        /* 5. ✅ 플로팅 메모장 (링크 동작 방해 요소 제거) */
        .editor-container {
            display: none; 
            opacity: 0; 
            position: fixed; 
            top: 150px; 
            left: 450px; 
            /* 링크 UI가 잘 보이도록 z-index를 적절히 조절 */
            z-index: 1000; 
            background: white; 
            border: 1px solid #ddd; 
            border-radius: 15px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.3);
            width: 800px; 
            min-width: 450px; 
            min-height: 400px;
            resize: both; 
            /* overflow: hidden; 대신 팝업이 밖으로 나갈 수 있게 처리 */
            transition: opacity 0.3s ease;
        }
        .editor-container.show { display: block; opacity: 1; }

        .date-title {
            font-size: 1.1rem;
            font-weight: bold;
            padding: 15px 20px;
            margin: 0;
            color: white;
            background: #2a72de; 
            border-radius: 12px 12px 0 0;
            cursor: move;
            user-select: none;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    
        #noteForm {
            padding: 20px;
            display: flex;
            flex-direction: column;
            height: calc(100% - 60px); 
        }
        
        .ck-editor__editable_inline {
            flex-grow: 1;
            min-height: 350px !important;
            background-color: white !important;
        }

        /* 다크모드 대응 */
        .dark { background: #1a1a1a !important; color: #eee; }
        .dark .calendar-box, .dark .notice-box, .dark .card, .dark .editor-container { 
            background: #2d2d2d; border-color: #444; color: #eee; 
        }
        .dark .ck-editor__editable_inline { background: #333 !important; color: white !important; }
    
        /* 반응형 (모바일 대응) */
        @media (max-width: 1100px) {
            .main-container { flex-direction: column; align-items: center; gap: 30px; }
            .side-panel { flex: 0 0 auto; width: 100%; max-width: 350px; position: relative; top: 0; }
            .content-panel { width: 100%; gap: 30px; }
            .cards-grid { grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); }
        }
    
        button#saveBtn {
            margin-top: 20px; background: #2a72de; color: white; border: none;
            border-radius: 8px; padding: 15px; font-weight: bold; width: 100%; cursor: pointer;
        }
    </style>
</head>
<body>

    <header>
        <h1>HN IDC</h1>
        <p class="subtitle">
            <a href="https://wiki.daumkakao.com/pages/viewpage.action?pageId=389453783" target="_blank" style="color:inherit; text-decoration:none;">Made by Shane</a>
        </p> 
        <div class="toggle-container">
            <label class="switch"><input type="checkbox" id="dm"><span class="slider round"></span></label>
        </div>
    </header>

    <div class="main-container">
        
        <div class="side-panel">
            <div class="calendar-box">
                <h5 style="font-weight: bold; margin-bottom: 20px;">Work Calendar</h5>
                <div id="inlineCalendar"></div>
                <p style="margin-top: 15px; font-size: 0.8rem; color: #aaa;">날짜를 클릭하여 업무 기록</p>
            </div>
        </div>

        <div class="content-panel">
            
            <div class="notice-box">
                <div class="notice-header">Notice</div>
                <div id="notice-content">
                    <p style="color: #888;">Develop.</p>
                </div>
            </div>

            <div class="cards-grid">
                <div class="card">
                    <div class="card-title">Asset Management</div>
                    <div class="link-list">
                        <a href="https://imsv2.onkakao.net/auth/jwt/login" target="_blank" class="link-item">
                            <img src="/static/img_v2/IMS_V2.png" class="link-icon" style="width:40px; height:40px;"> IMSv2
                        </a>
                        <a href="https://ims.daumkakao.io/stock/part/view" target="_blank" class="link-item">
                            <img src="/static/img_v2/IMS.ico" class="link-icon" style="width:40px; height:40px;"> IMSv1-파트 관리
                        </a>
                        <a href="http://dceservice.ay1.krane.9rum.cc/DAC/dashboard.html" target="_blank" class="link-item">
                            <img src="/static/img_v2/Asset01.png" class="link-icon" style="width:40px; height:40px;"> WEB-파트 관리
                        </a>
                        <a href="https://ims.daumkakao.io/asset/assetListForm" target="_blank" class="link-item">
                            <img src="/static/img_v2/IMS.ico" class="link-icon" style="width:40px; height:40px;"> IMSv1-바코드 출력
                        </a>
                        <a href="https://ims.daumkakao.io/stock/check/view" target="_blank" class="link-item">
                            <img src="/static/img_v2/IMS.ico" class="link-icon" style="width:40px; height:40px;"> IMSv1-재고 실사
                        </a>
                        <a href="https://ims.daumkakao.io/system/rack/layout/main#" target="_blank" class="link-item">
                            <img src="/static/img_v2/IMS.ico" class="link-icon" style="width:40px; height:40px;"> IMSv1-Rack View
                        </a>
                        <a href="http://hn-uber.ay1.krane.9rum.cc:3000/warehouse" target="_blank" class="link-item">
                            <img src="/static/img_v2/ware.ico" class="link-icon" style="width:40px; height:40px;"> 하남 창고관리
                        </a>
                        <a href="http://idc-asset.ay1.krane.9rum.cc:5050/hndc" target="_blank" class="link-item">
                            <img src="/static/img_v2/Asset02.png" class="link-icon" style="width:40px; height:40px;"> 대여 자산관리
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1YafoGYdzAJxk4J7lewWkp1QExtjJFc5EVWDQxXkFTZQ/edit?gid=941992273#gid=941992273" target="_blank" class="link-item">
                            <img src="/static/img_v2/Cable.png" class="link-icon" style="width:40px; height:40px;"> 네트워크 자산관리
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1hsv3yXx5tUbhJLsOyhu_Y4pYsFLv-_tfbFSc34NNki4/edit?gid=708510480#gid=708510480" target="_blank" class="link-item">
                            <img src="/static/img_v2/GPU.png" class="link-icon" style="width:40px; height:40px;"> GPU 장애처리 파트관리
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1cRlqD9DMiqGt38-QLZULx2Wi2V461iTs4nVBeJ8RO6E/edit?gid=0#gid=0" target="_blank" class="link-item">
                            <img src="/static/img_v2/NIC.png" class="link-icon" style="width:40px; height:40px;"> NIC 파트 관리
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/18UgvHnZkRmCp0LD8dZHVpzqK_dSUTbVHgdQ6lBEwuxg/edit?gid=564355290#gid=564355290" target="_blank" class="link-item">
                            <img src="/static/img_v2/GBIC.png" class="link-icon" style="width:40px; height:40px;"> Citrix GBIC 파트 관리
                        </a>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Error Management</div>
                    <div class="link-list">
                        <a href="https://tms.daumkakao.io/faulthandle/faultHandling.do" target="_blank" class="link-item">
                            <img src="/static/img_v2/TMS.ico" class="link-icon" style="width:45px; height:45px;"> TMS - 메인
                        </a>
                        <a href="https://tms.daumkakao.io/dws/dwsList.do" target="_blank" class="link-item">
                            <img src="/static/img_v2/TMS.ico" class="link-icon" style="width:45px; height:45px;"> TMS - 작업 리스트 등록
                        </a>
                        <a href="https://tms.daumkakao.io/hwproc/hwprocInputList.do" target="_blank" class="link-item">
                            <img src="/static/img_v2/TMS.ico" class="link-icon" style="width:45px; height:45px;"> TMS - 장애처리 상세 등록
                        </a>
                        <a href="http://dceng-dcnegweb.ay1.krane.9rum.cc/IDC/disk" target="_blank" class="link-item">
                            <img src="/static/img_v2/disk1.ico" class="link-icon" style="width:45px; height:45px;"> DISK - 삭제 정보 등록
                        </a>
                        <a href="http://10.91.9.137:4001/hn/all" target="_blank" class="link-item">
                            <img src="/static/img_v2/Hadoop.png" class="link-icon" style="width:45px; height:45px;"> DISK - 하둡 장애 이력 등록
                        </a>
                        <a href="http://dktechin-ay-test2.dakao.io/rma/hndc" target="_blank" class="link-item">
                            <img src="/static/img_v2/RMA.png" class="link-icon" style="width:45px; height:45px;"> RMA
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1YfYooWJutQLFl2xmTaFfE5zXzuwSzVXCSCiOab9HD38/edit?gid=295829977#gid=295829977" target="_blank" class="link-item">
                            <img src="/static/img_v2/GBIC.png" class="link-icon" style="width:45px; height:45px;"> RMA-GBIC
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1jX6NDZSC2ypctELxeMyT9n9nmGMvLZv3wFEqLvISnYc/edit?gid=0#gid=0" target="_blank" class="link-item">
                            <img src="/static/img_v2/Network_Cable.png" class="link-icon" style="width:45px; height:45px;"> DAC-ErrorBoard
                        </a>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Working</div>
                    <div class="link-list">
                        <a href="https://dkt.agit.in/g/274966/wall" target="_blank" class="link-item">
                            <img src="/static/img_v2/agit.png" class="link-icon" style="width:45px; height:45px;"> Agit
                        </a>
                        <a href="https://knock.kakaosecure.net/" target="_blank" class="link-item">
                            <img src="/static/img_v2/Knock.png" class="link-icon" style="width:45px; height:45px;"> 똑똑 - 출입 신청 시스템
                        </a>
                        <a href="https://mail.kakaowork.com/mail/list.do" target="_blank" class="link-item">
                            <img src="/static/img_v2/Mail.png" class="link-icon" style="width:45px; height:45px;"> 메일
                        </a>
                        <a href="https://op-idccal.daumtools.com/" target="_blank" class="link-item">
                            <img src="/static/img_v2/Schedule.png" class="link-icon" style="width:45px; height:45px;"> 스케줄
                        </a>
                        <a href="http://dceng-dcnegweb.ay1.krane.9rum.cc/IDC/report/hndc" target="_blank" class="link-item">
                            <img src="/static/img_v2/workbook.png" class="link-icon" style="width:45px; height:45px;"> 업무 일지
                        </a>
                        <a href="http://dceng-app.ay1.krane.9rum.cc:2020/hndc" target="_blank" class="link-item">
                            <img src="/static/img_v2/check.png" class="link-icon" style="width:45px; height:45px;"> 육안점검
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1sl-MfGJnL3U5uafHhiux3gQ5N-HkHrXNn_x_Yo_GmZY/edit?gid=1761427498#gid=1761427498" target="_blank" class="link-item">
                            <img src="/static/img_v1/google_sheet_48.png" class="link-icon" style="width:45px; height:45px;">HN Work List
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1DQbUzjAjEGw_Ix5zczFmY21v4Xhxk-ch1hmfeNYMDTs/edit?gid=996840399#gid=996840399" target="_blank" class="link-item">
                            <img src="/static/img_v1/google_sheet_48.png" class="link-icon" style="width:45px; height:45px;">HN CPLD List
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1sl-MfGJnL3U5uafHhiux3gQ5N-HkHrXNn_x_Yo_GmZY/edit?gid=1669881149#gid=1669881149" target="_blank" class="link-item">
                            <img src="/static/img_v1/google_sheet_48.png" class="link-icon" style="width:45px; height:45px;">HN IPMI 대역
                        </a>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Service & Forfault</div>
                    <div class="link-list">
                        <a href="https://karas.daumkakao.io/login?redirect=http://karas.daumkakao.io/" target="_blank" class="link-item">
                            <img src="/static/img_v2/Karas.png" class="link-icon" style="width:50px; height:50px;"> Karas
                        </a>
                        <a href="https://dkt.agit.in/g/300004802/wall/375105522#comment_panel_428427200" target="_blank" class="link-item">
                            <img src="/static/img_v2/Kage.png" class="link-icon" style="width:50px; height:50px;"> Kage
                        </a>
                        <a href="https://dkt.agit.in/g/300015037/wall/427347275#comment_panel_427373875" target="_blank" class="link-item">
                            <img src="/static/img_v2/Tset.png" class="link-icon" style="width:50px; height:50px;"> Tenth
                        </a>
                        <a href="https://dkt.agit.in/g/300002967/wall/320850203#comment_panel_403989670" target="_blank" class="link-item">
                            <img src="/static/img_v2/Krane.png" class="link-icon" style="width:50px; height:50px;"> Krane
                        </a>
                        <a href="https://imsv2.onkakao.net/system-asset/servers?pageSize=50&page=0&locB_in=HN1%2CHN3&parentSvcId=264946" target="_blank" class="link-item">
                            <img src="/static/img_v2/Krane.png" class="link-icon" style="width:50px; height:50px;"> Krane - Forfault
                        </a>
                        <a href="https://dkt.agit.in/g/300002967/wall/326758164#comment_panel_390768788" target="_blank" class="link-item">
                            <img src="/static/img_v2/Kafka.png" class="link-icon" style="width:50px; height:50px;"> Kfaka
                        </a>
                        <a href="https://imsv2.onkakao.net/system-asset/servers?pageSize=50&page=0&locB_in=HN1%2CHN3&parentSvcId=68527" target="_blank" class="link-item">
                            <img src="/static/img_v2/Kafka.png" class="link-icon" style="width:50px; height:50px;"> Kfaka - Forfault
                        </a>
                        <a href="https://dkt.agit.in/g/300004802/wall/429662243" target="_blank" class="link-item">
                            <img src="/static/img_v2/Elasticsearch.png" class="link-icon" style="width:50px; height:50px;"> ElasticSearch
                        </a>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ETC</div>
                    <div class="link-list">
                        <a href="http://kkoidc-web-v1.ay1.krane.9rum.cc:8262" target="_blank" class="link-item">
                            <img src="/static/img_v2/Quick.png" class="link-icon" style="width:50px; height:50px;"> 퀵 사용대장
                        </a>
                        <a href="http://10.202.27.232:8000/sub/" target="_blank" class="link-item">
                            <img src="/static/favicon/favicon_sub.png" class="link-icon" style="width:50px; height:50px;"> 엑셀 변환기
                        </a>
                        <a href="http://10.203.8.166/" target="_blank" class="link-item">
                            <img src="/static/img_v2/Network_Cable.png" class="link-icon" style="width:50px; height:50px;"> 케이블 길이 계산기
                        </a>
                        <a href="https://start.dktechin.io/?kw-auth-handover=21d562075813134b9c18d65b0a3fc5efd958035b6e667791b7e5c6babac80434" target="_blank" class="link-item">
                            <img src="/static/img_v2/kakao.png" class="link-icon" style="width:50px; height:50px;"> 인트라넷
                        </a>
                        <a href="https://wlb.dktechin.io/login" target="_blank" class="link-item">
                            <img src="/static/img_v2/kakao.png" class="link-icon" style="width:50px; height:50px;"> 휴가 시스템
                        </a>
                        <a href="https://eaccount.dktechin.io/" target="_blank" class="link-item">
                            <img src="/static/img_v2/kakao.png" class="link-icon" style="width:50px; height:50px;"> 경비 지출 관리-회계마감
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="editor-container" id="editorWrapper">
        <div class="date-title" id="dragHandle">
            <span id="selectedDateText">날짜를 선택하세요</span>
            <span style="font-size: 0.7rem; opacity: 0.7;">[MOVE & RESIZE]</span>
        </div>
        <form id="noteForm">
            <textarea id="editor" name="content"></textarea>
            <button type="submit" id="saveBtn">Save</button>
        </form>
    </div>

    <script src="{% static 'flatpickr/flatpickr.min.js' %}"></script>
    <script src="{% static 'flatpickr/ko.js' %}"></script>
    <script src="{% static 'django_ckeditor_5/dist/bundle.js' %}"></script>

    <script>
        // ✅ [JS] 다크모드 토글
        document.getElementById("dm").addEventListener("change", () => {
            document.body.classList.toggle("dark");
        });

        let selectedDate = null;
        let editorInstance;
        let calendar;

        // ✅ [JS] 드래그 기능
        function initDraggable(el) {
            const handle = document.getElementById("dragHandle");
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;
            handle.onmousedown = (e) => {
                if (e.target !== handle && e.target.parentNode !== handle) return;
                e.preventDefault();
                pos3 = e.clientX; pos4 = e.clientY;
                document.onmouseup = () => { document.onmouseup = null; document.onmousemove = null; };
                document.onmousemove = (e) => {
                    pos1 = pos3 - e.clientX; pos2 = pos4 - e.clientY;
                    pos3 = e.clientX; pos4 = e.clientY;
                    el.style.top = (el.offsetTop - pos2) + "px";
                    el.style.left = (el.offsetLeft - pos1) + "px";
                };
            };
        }

        // ✅ [JS] 에디터 토글 및 외부 클릭 시 닫기
        function toggleEditorUI(show, dateStr = "") {
            const wrapper = document.getElementById('editorWrapper');
            const dateText = document.getElementById('selectedDateText');
            if (show) {
                dateText.innerText = `${dateStr} 운영 업무`;
                wrapper.classList.add('show');
            } else { wrapper.classList.remove('show'); }
        }

        document.addEventListener('mousedown', function(e) {
            const wrapper = document.getElementById('editorWrapper');
            // 에디터 밖 클릭 시 닫기 (단, CKEditor 내부 팝업 클릭은 제외)
            if (wrapper.classList.contains('show') && 
                !wrapper.contains(e.target) && 
                !e.target.closest('.flatpickr-day') &&
                !e.target.closest('.ck-body-wrapper')) {
                selectedDate = null;
                toggleEditorUI(false);
            }
        });

        // ✅ [JS] CKEditor 초기화
        function initEditor() {
            ClassicEditor.create(document.querySelector('#editor'), {
                licenseKey: 'GPL', 
                toolbar: [
                    'heading', '|', 'bold', 'italic', 'underline', 'strikethrough', 'highlight', '|',
                    'fontSize', 'fontFamily', 'fontColor', 'fontBackgroundColor', '|',
                    'bulletedList', 'numberedList', 'todoList', 'insertTable', 'alignment', 'outdent', 'indent', '|',
                    'code', 'codeBlock', 'blockQuote', 'horizontalLine', 'specialCharacters', '|',
                    'link', 'undo', 'redo'
                ],
                balloonToolbar: ['bold', 'italic', 'underline', 'highlight', 'link'],
                link: { addTargetToExternalLinks: true, defaultProtocol: 'https://' }
            }).then(editor => {
                editorInstance = editor;
                const lastDate = localStorage.getItem('last_selected_date');
                if (lastDate) {
                    selectedDate = lastDate; calendar.setDate(lastDate, true);
                    toggleEditorUI(true, lastDate); loadNoteForDate(lastDate);
                }
            });
        }

        function loadNoteForDate(dateStr) {
            if (!editorInstance) return;
            editorInstance.setData(''); 
            fetch(`get_work/?date=${dateStr}`).then(res => res.json()).then(data => {
                editorInstance.setData(data.content || '');
            });
        }

        // ✅ [JS] 달력 초기화
        calendar = flatpickr("#inlineCalendar", {
            inline: true, locale: "ko", dateFormat: "Y-m-d",
            onChange: function(selectedDates, dateStr) {
                if (selectedDate === dateStr) { selectedDate = null; toggleEditorUI(false); }
                else {
                    selectedDate = dateStr; localStorage.setItem('last_selected_date', dateStr);
                    toggleEditorUI(true, dateStr); loadNoteForDate(dateStr);
                }
            }
        });

        // ✅ [JS] 저장 로직
        document.getElementById("noteForm").addEventListener("submit", function(e) {
            e.preventDefault();
            const content = editorInstance.getData();
            if (!content.replace(/<[^>]*>/g, '').trim()) return alert("내용을 입력해주세요.");

            fetch('save_work/', {
                method: 'POST',
                headers: { 'Content-Type': 'application/x-www-form-urlencoded', 'X-CSRFToken': '{{ csrf_token }}' },
                body: new URLSearchParams({ date: selectedDate, content: content })
            }).then(res => res.json()).then(data => { if (data.success) alert(selectedDate + " 저장 완료"); });
        });

        initEditor();
        initDraggable(document.getElementById('editorWrapper'));
    </script>
</body>
</html>