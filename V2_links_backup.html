<!-- ì´ˆê¸° ë²„ì „ ë ˆì´ì•„ì›ƒ ì„¤ì •O, ë§í¬ ê¸°ëŠ¥ ì•ˆë˜ëŠ” ë¶€ë¶„ ì›ì¸ cssë¡œ ë°œê²¬ë˜ì—ˆìŒ -->
<!DOCTYPE html>
<html lang="ko">
{% load static %}
<head>
    <meta charset="UTF-8">
    <title>HN IDC</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    
    <link rel="icon" type="image/png" href="{% static 'img_v2/Link_96.png' %}">
    <link rel="stylesheet" href="{% static 'bootstrap/bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'style_v3.css' %}">
    <link rel="stylesheet" href="{% static 'flatpickr/flatpickr.min.css' %}">
    <link rel="stylesheet" href="{% static 'django_ckeditor_5/dist/styles.css' %}">

    <style>
        /* 1. ê¸°ë³¸ ë² ì´ìŠ¤ */
        body {
            font-family: 'Noto Sans KR', sans-serif;
            background: #f7f7f7;
            margin: 0;
            padding: 40px; /* ì™¸ë¶€ ì—¬ë°± í™•ì¥ */
            transition: background 0.3s;
            overflow-x: hidden;
        }
    
        header { text-align: center; margin-bottom: 40px; } /* í—¤ë”ì™€ ë³¸ë¬¸ ì‚¬ì´ ê°„ê²© í™•ëŒ€ */
        .subtitle { color: #aaa; font-style: italic; font-size: 0.9rem; }
    
        /* 2. âœ… ë©”ì¸ ë ˆì´ì•„ì›ƒ */
        .main-container {
            display: flex;
            gap: 50px; 
            max-width: 100%;
            margin: 0 auto;
            align-items: flex-start;
            flex-wrap: nowrap;
        }
    
        /* â¬…ï¸ ì¢Œì¸¡ ì‚¬ì´ë“œë°” (ë‹¬ë ¥) */
        .side-panel {
            flex: 0 0 350px;
            position: sticky;
            top: 40px; /* ìƒë‹¨ ê³ ì • ìœ„ì¹˜ ì—¬ë°± í™•ëŒ€ */
            z-index: 10;
        }
    
        .calendar-box {
            background: white;
            padding: 30px; /* ë‹¬ë ¥ ë‚´ë¶€ ì—¬ë°± í™•ëŒ€ */
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            text-align: center;
        }
    
        /* â¡ï¸ ìš°ì¸¡ ë©”ì¸ íŒ¨ë„ (ê³µì§€ + ì¹´ë“œ) */
        .content-panel {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 40px; /* ğŸ‘ˆ ê³µì§€ì‚¬í•­ ë°•ìŠ¤ì™€ í•˜ë‹¨ ì¹´ë“œ ê·¸ë¦¬ë“œ ì‚¬ì´ì˜ ì„¸ë¡œ ê°„ê²© í™•ëŒ€ */
            min-width: 0;
        }
    
        /* 3. ê³µì§€ì‚¬í•­ ì„¹ì…˜ */
        .notice-box {
            background: white;
            padding: 30px; /* ë‚´ë¶€ ì—¬ë°± í™•ëŒ€ */
            border-radius: 15px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.05);
            border: 1px solid #e0e0e0;
            min-height: 120px;
        }
        .notice-header { 
            font-weight: bold; 
            color: #2a72de; 
            margin-bottom: 20px; 
            font-size: 1.2rem; 
            display: flex; 
            align-items: center; 
            gap: 10px;
        }
    
        /* 4. âœ… ë™ì  ì¹´ë“œ ê·¸ë¦¬ë“œ (ì¹´ë“œ ê°„ ê°„ê²© ì¡°ì •) */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 30px; /* ğŸ‘ˆ ì¹´ë“œì™€ ì¹´ë“œ ì‚¬ì´ì˜ ìƒí•˜ì¢Œìš° ê°„ê²© í™•ëŒ€ (ê¸°ì¡´ 15px) */
        }
    
        @media (min-width: 1600px) {
            .cards-grid { grid-template-columns: repeat(5, 1fr); }
        }
    
        .card {
            margin-bottom: 0 !important;
            background: white;
            border-radius: 12px;
            border: 1px solid #eef2f7;
            height: 100%;
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .card-title { font-size: 1.1rem !important; font-weight: bold; padding: 15px !important; border-bottom: 1px solid #f0f0f0; }
    
        /* 5. í”Œë¡œíŒ… ë©”ëª¨ì¥ (ë™ì¼ ìœ ì§€) */
        .editor-container {
            display: none; opacity: 0; position: fixed; 
            top: 150px; left: 450px; z-index: 2000;
            background: white; border: 1px solid #ddd; border-radius: 15px;
            box-shadow: 0 25px 60px rgba(0,0,0,0.3);
            width: 800px; min-width: 450px; min-height: 400px;
            resize: both; overflow: hidden; transition: opacity 0.3s ease;
        }
        .editor-container.show { display: block; opacity: 1; }

        /* âœ… ë“œë˜ê·¸ í•¸ë“¤ (ì œëª© í‘œì‹œì¤„) */
        .date-title {
            font-size: 1.1rem;
            font-weight: bold;
            padding: 15px 20px;
            margin: 0;
            color: white;
            background: #2a72de; 
            border-radius: 12px 12px 0 0;
            cursor: move; /* ì´ë™ ì»¤ì„œ */
            user-select: none; /* í…ìŠ¤íŠ¸ ì„ íƒ ë°©ì§€ */
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
    
        #noteForm {
            padding: 20px;
            display: flex;
            flex-direction: column;
            /* ì°½ í¬ê¸°ì— ë§ì¶° í¼ ë†’ì´ ì¡°ì ˆ */
            height: calc(100% - 60px); 
        }
        
        /* ì—ë””í„° ë‚´ë¶€ ë†’ì´ ìë™ ì¡°ì ˆ */
        .ck-editor__editable_inline {
            flex-grow: 1;
            min-height: 350px !important;
            background-color: white !important;
        }

        /* ì½”ë“œ ë¸”ë¡ ë° í˜•ê´‘íœ ìŠ¤íƒ€ì¼ (ê¸°ì¡´ ìœ ì§€) */
        .ck-content pre { background-color: #2b2b2b !important; color: #f8f8f2 !important; padding: 1em !important; border-radius: 5px !important; }
        .pen-yellow { background-color: #fff34d !important; }
        .pen-green { background-color: #7ef9ff !important; }
        .pen-pink { background-color: #ff7eb9 !important; }

        button#saveBtn {
            margin-top: 15px;
            background: #2a72de;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 24px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            width: 100%;
            transition: background 0.2s;
        }
        button#saveBtn:hover { background: #1e56a0; }

        .flatpickr-calendar { width: 350px !important; }
    
        /* 6. ë‹¤í¬ëª¨ë“œ (ë™ì¼ ìœ ì§€) */
        .dark { background: #1a1a1a !important; color: #eee; }
        .dark .calendar-box, .dark .notice-box, .dark .card, .dark .editor-container { 
            background: #2d2d2d; border-color: #444; color: #eee; 
        }
        .dark .ck-editor__editable_inline { background: #333 !important; color: white !important; }
    
        /* 7. ëª¨ë°”ì¼ ëŒ€ì‘ ì‹œ ê°„ê²© ì¬ì¡°ì • */
        @media (max-width: 1100px) {
            .main-container { flex-direction: column; align-items: center; gap: 30px; }
            .side-panel { flex: 0 0 auto; width: 100%; max-width: 350px; position: relative; top: 0; }
            .content-panel { width: 100%; gap: 30px; }
        }
    
        button#saveBtn {
            margin-top: 20px; background: #2a72de; color: white; border: none;
            border-radius: 8px; padding: 15px; font-weight: bold; width: 100%; cursor: pointer;
        }
    </style>
</head>
<body class="">

    <header>
        <h1>HN IDC</h1>
        <p class="subtitle">
            <a href="https://wiki.daumkakao.com/pages/viewpage.action?pageId=389453783" target="_blank" style="color:inherit; text-decoration:none;">Made by Shane</a>
        </p> 
        <div class="toggle-container">
            <label class="switch"><input type="checkbox" id="dm"><span class="slider round"></span></label>
        </div>
    </header>

    <div class="main-container">
        
        <div class="side-panel">
            <div class="calendar-box">
                <h5 style="font-weight: bold; margin-bottom: 20px;">Work Calendar</h5>
                <div id="inlineCalendar"></div>
                <p style="margin-top: 15px; font-size: 0.8rem; color: #aaa;">ë‚ ì§œë¥¼ í´ë¦­í•˜ì—¬ ì—…ë¬´ ê¸°ë¡</p>
            </div>
        </div>

        <div class="content-panel">
            
            <div class="notice-box">
                <div class="notice-header">Notice</div>
                <div id="notice-content">
                    <p style="color: #888;">Develop.</p>
                </div>
            </div>

            <div class="cards-grid">
                <div class="card">
                    <div class="card-title">Asset Management</div>
                    <div class="link-list">
                        <a href="https://imsv2.onkakao.net/auth/jwt/login" target="_blank" class="link-item">
                            <img src="/static/img_v2/IMS_V2.png" class="link-icon" style="width:40px; height:40px;"> IMSv2
                        </a>
                        <a href="https://ims.daumkakao.io/stock/part/view" target="_blank" class="link-item">
                            <img src="/static/img_v2/IMS.ico" class="link-icon" style="width:40px; height:40px;"> IMSv1-íŒŒíŠ¸ ê´€ë¦¬
                        </a>
                        <a href="http://dceservice.ay1.krane.9rum.cc/DAC/dashboard.html" target="_blank" class="link-item">
                            <img src="/static/img_v2/Asset01.png" class="link-icon" style="width:40px; height:40px;"> WEB-íŒŒíŠ¸ ê´€ë¦¬
                        </a>
                        <a href="https://ims.daumkakao.io/asset/assetListForm" target="_blank" class="link-item">
                            <img src="/static/img_v2/IMS.ico" class="link-icon" style="width:40px; height:40px;"> IMSv1-ë°”ì½”ë“œ ì¶œë ¥
                        </a>
                        <a href="https://ims.daumkakao.io/stock/check/view" target="_blank" class="link-item">
                            <img src="/static/img_v2/IMS.ico" class="link-icon" style="width:40px; height:40px;"> IMSv1-ì¬ê³  ì‹¤ì‚¬
                        </a>
                        <a href="https://ims.daumkakao.io/system/rack/layout/main#" target="_blank" class="link-item">
                            <img src="/static/img_v2/IMS.ico" class="link-icon" style="width:40px; height:40px;"> IMSv1-Rack View
                        </a>
                        <a href="http://hn-uber.ay1.krane.9rum.cc:3000/warehouse" target="_blank" class="link-item">
                            <img src="/static/img_v2/ware.ico" class="link-icon" style="width:40px; height:40px;"> í•˜ë‚¨ ì°½ê³ ê´€ë¦¬
                        </a>
                        <a href="http://idc-asset.ay1.krane.9rum.cc:5050/hndc" target="_blank" class="link-item">
                            <img src="/static/img_v2/Asset02.png" class="link-icon" style="width:40px; height:40px;"> ëŒ€ì—¬ ìì‚°ê´€ë¦¬
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1YafoGYdzAJxk4J7lewWkp1QExtjJFc5EVWDQxXkFTZQ/edit?gid=941992273#gid=941992273" target="_blank" class="link-item">
                            <img src="/static/img_v2/Cable.png" class="link-icon" style="width:40px; height:40px;"> ë„¤íŠ¸ì›Œí¬ ìì‚°ê´€ë¦¬
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1hsv3yXx5tUbhJLsOyhu_Y4pYsFLv-_tfbFSc34NNki4/edit?gid=708510480#gid=708510480" target="_blank" class="link-item">
                            <img src="/static/img_v2/GPU.png" class="link-icon" style="width:40px; height:40px;"> GPU ì¥ì• ì²˜ë¦¬ íŒŒíŠ¸ê´€ë¦¬
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1cRlqD9DMiqGt38-QLZULx2Wi2V461iTs4nVBeJ8RO6E/edit?gid=0#gid=0" target="_blank" class="link-item">
                            <img src="/static/img_v2/NIC.png" class="link-icon" style="width:40px; height:40px;"> NIC íŒŒíŠ¸ ê´€ë¦¬
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/18UgvHnZkRmCp0LD8dZHVpzqK_dSUTbVHgdQ6lBEwuxg/edit?gid=564355290#gid=564355290" target="_blank" class="link-item">
                            <img src="/static/img_v2/GBIC.png" class="link-icon" style="width:40px; height:40px;"> Citrix GBIC íŒŒíŠ¸ ê´€ë¦¬
                        </a>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Error Management</div>
                    <div class="link-list">
                        <a href="https://tms.daumkakao.io/faulthandle/faultHandling.do" target="_blank" class="link-item">
                            <img src="/static/img_v2/TMS.ico" class="link-icon" style="width:45px; height:45px;"> TMS - ë©”ì¸
                        </a>
                        <a href="https://tms.daumkakao.io/dws/dwsList.do" target="_blank" class="link-item">
                            <img src="/static/img_v2/TMS.ico" class="link-icon" style="width:45px; height:45px;"> TMS - ì‘ì—… ë¦¬ìŠ¤íŠ¸ ë“±ë¡
                        </a>
                        <a href="https://tms.daumkakao.io/hwproc/hwprocInputList.do" target="_blank" class="link-item">
                            <img src="/static/img_v2/TMS.ico" class="link-icon" style="width:45px; height:45px;"> TMS - ì¥ì• ì²˜ë¦¬ ìƒì„¸ ë“±ë¡
                        </a>
                        <a href="http://dceng-dcnegweb.ay1.krane.9rum.cc/IDC/disk" target="_blank" class="link-item">
                            <img src="/static/img_v2/disk1.ico" class="link-icon" style="width:45px; height:45px;"> DISK - ì‚­ì œ ì •ë³´ ë“±ë¡
                        </a>
                        <a href="http://10.91.9.137:4001/hn/all" target="_blank" class="link-item">
                            <img src="/static/img_v2/Hadoop.png" class="link-icon" style="width:45px; height:45px;"> DISK - í•˜ë‘¡ ì¥ì•  ì´ë ¥ ë“±ë¡
                        </a>
                        <a href="http://dktechin-ay-test2.dakao.io/rma/hndc" target="_blank" class="link-item">
                            <img src="/static/img_v2/RMA.png" class="link-icon" style="width:45px; height:45px;"> RMA
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1YfYooWJutQLFl2xmTaFfE5zXzuwSzVXCSCiOab9HD38/edit?gid=295829977#gid=295829977" target="_blank" class="link-item">
                            <img src="/static/img_v2/GBIC.png" class="link-icon" style="width:45px; height:45px;"> RMA-GBIC
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1jX6NDZSC2ypctELxeMyT9n9nmGMvLZv3wFEqLvISnYc/edit?gid=0#gid=0" target="_blank" class="link-item">
                            <img src="/static/img_v2/Network_Cable.png" class="link-icon" style="width:45px; height:45px;"> DAC-ErrorBoard
                        </a>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Working</div>
                    <div class="link-list">
                        <a href="https://dkt.agit.in/g/274966/wall" target="_blank" class="link-item">
                            <img src="/static/img_v2/agit.png" class="link-icon" style="width:45px; height:45px;"> Agit
                        </a>
                        <a href="https://knock.kakaosecure.net/" target="_blank" class="link-item">
                            <img src="/static/img_v2/Knock.png" class="link-icon" style="width:45px; height:45px;"> ë˜‘ë˜‘ - ì¶œì… ì‹ ì²­ ì‹œìŠ¤í…œ
                        </a>
                        <a href="https://mail.kakaowork.com/mail/list.do" target="_blank" class="link-item">
                            <img src="/static/img_v2/Mail.png" class="link-icon" style="width:45px; height:45px;"> ë©”ì¼
                        </a>
                        <a href="https://op-idccal.daumtools.com/" target="_blank" class="link-item">
                            <img src="/static/img_v2/Schedule.png" class="link-icon" style="width:45px; height:45px;"> ìŠ¤ì¼€ì¤„
                        </a>
                        <a href="http://dceng-dcnegweb.ay1.krane.9rum.cc/IDC/report/hndc" target="_blank" class="link-item">
                            <img src="/static/img_v2/workbook.png" class="link-icon" style="width:45px; height:45px;"> ì—…ë¬´ ì¼ì§€
                        </a>
                        <a href="http://dceng-app.ay1.krane.9rum.cc:2020/hndc" target="_blank" class="link-item">
                            <img src="/static/img_v2/check.png" class="link-icon" style="width:45px; height:45px;"> ìœ¡ì•ˆì ê²€
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1sl-MfGJnL3U5uafHhiux3gQ5N-HkHrXNn_x_Yo_GmZY/edit?gid=1761427498#gid=1761427498" target="_blank" class="link-item">
                            <img src="/static/img_v1/google_sheet_48.png" class="link-icon" style="width:45px; height:45px;">HN Work List
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1DQbUzjAjEGw_Ix5zczFmY21v4Xhxk-ch1hmfeNYMDTs/edit?gid=996840399#gid=996840399" target="_blank" class="link-item">
                            <img src="/static/img_v1/google_sheet_48.png" class="link-icon" style="width:45px; height:45px;">HN CPLD List
                        </a>
                        <a href="https://docs.google.com/spreadsheets/d/1sl-MfGJnL3U5uafHhiux3gQ5N-HkHrXNn_x_Yo_GmZY/edit?gid=1669881149#gid=1669881149" target="_blank" class="link-item">
                            <img src="/static/img_v1/google_sheet_48.png" class="link-icon" style="width:45px; height:45px;">HN IPMI ëŒ€ì—­
                        </a>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">Service & Forfault</div>
                    <div class="link-list">
                        <a href="https://karas.daumkakao.io/login?redirect=http://karas.daumkakao.io/" target="_blank" class="link-item">
                            <img src="/static/img_v2/Karas.png" class="link-icon" style="width:50px; height:50px;"> Karas
                        </a>
                        <a href="https://dkt.agit.in/g/300004802/wall/375105522#comment_panel_428427200" target="_blank" class="link-item">
                            <img src="/static/img_v2/Kage.png" class="link-icon" style="width:50px; height:50px;"> Kage
                        </a>
                        <a href="https://dkt.agit.in/g/300015037/wall/427347275#comment_panel_427373875" target="_blank" class="link-item">
                            <img src="/static/img_v2/Tset.png" class="link-icon" style="width:50px; height:50px;"> Tenth
                        </a>
                        <a href="https://dkt.agit.in/g/300002967/wall/320850203#comment_panel_403989670" target="_blank" class="link-item">
                            <img src="/static/img_v2/Krane.png" class="link-icon" style="width:50px; height:50px;"> Krane
                        </a>
                        <a href="https://imsv2.onkakao.net/system-asset/servers?pageSize=50&page=0&locB_in=HN1%2CHN3&parentSvcId=264946" target="_blank" class="link-item">
                            <img src="/static/img_v2/Krane.png" class="link-icon" style="width:50px; height:50px;"> Krane - Forfault
                        </a>
                        <a href="https://dkt.agit.in/g/300002967/wall/326758164#comment_panel_390768788" target="_blank" class="link-item">
                            <img src="/static/img_v2/Kafka.png" class="link-icon" style="width:50px; height:50px;"> Kfaka
                        </a>
                        <a href="https://imsv2.onkakao.net/system-asset/servers?pageSize=50&page=0&locB_in=HN1%2CHN3&parentSvcId=68527" target="_blank" class="link-item">
                            <img src="/static/img_v2/Kafka.png" class="link-icon" style="width:50px; height:50px;"> Kfaka - Forfault
                        </a>
                        <a href="https://dkt.agit.in/g/300004802/wall/429662243" target="_blank" class="link-item">
                            <img src="/static/img_v2/Elasticsearch.png" class="link-icon" style="width:50px; height:50px;"> ElasticSearch
                        </a>
                    </div>
                </div>

                <div class="card">
                    <div class="card-title">ETC</div>
                    <div class="link-list">
                        <a href="http://kkoidc-web-v1.ay1.krane.9rum.cc:8262" target="_blank" class="link-item">
                            <img src="/static/img_v2/Quick.png" class="link-icon" style="width:50px; height:50px;"> í€µ ì‚¬ìš©ëŒ€ì¥
                        </a>
                        <a href="http://10.202.27.232:8000/sub/" target="_blank" class="link-item">
                            <img src="/static/favicon/favicon_sub.png" class="link-icon" style="width:50px; height:50px;"> ì—‘ì…€ ë³€í™˜ê¸°
                        </a>
                        <a href="http://10.203.8.166/" target="_blank" class="link-item">
                            <img src="/static/img_v2/Network_Cable.png" class="link-icon" style="width:50px; height:50px;"> ì¼€ì´ë¸” ê¸¸ì´ ê³„ì‚°ê¸°
                        </a>
                        <a href="https://start.dktechin.io/?kw-auth-handover=21d562075813134b9c18d65b0a3fc5efd958035b6e667791b7e5c6babac80434" target="_blank" class="link-item">
                            <img src="/static/img_v2/kakao.png" class="link-icon" style="width:50px; height:50px;"> ì¸íŠ¸ë¼ë„·
                        </a>
                        <a href="https://wlb.dktechin.io/login" target="_blank" class="link-item">
                            <img src="/static/img_v2/kakao.png" class="link-icon" style="width:50px; height:50px;"> íœ´ê°€ ì‹œìŠ¤í…œ
                        </a>
                        <a href="https://eaccount.dktechin.io/" target="_blank" class="link-item">
                            <img src="/static/img_v2/kakao.png" class="link-icon" style="width:50px; height:50px;"> ê²½ë¹„ ì§€ì¶œ ê´€ë¦¬-íšŒê³„ë§ˆê°
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="editor-container" id="editorWrapper">
        <div class="date-title" id="dragHandle">
            <span id="selectedDateText">ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</span>
            <span style="font-size: 0.7rem; opacity: 0.7;">[MOVE & RESIZE]</span>
        </div>
        <form id="noteForm">
            <textarea id="editor" name="content"></textarea>
            <button type="submit" id="saveBtn">Save</button>
        </form>
    </div>

    <script src="{% static 'flatpickr/flatpickr.min.js' %}"></script>
    <script src="{% static 'flatpickr/ko.js' %}"></script>
    <script src="{% static 'django_ckeditor_5/dist/bundle.js' %}"></script>

    <script>
        let selectedDate = null;
        let editorInstance;
        let calendar;

        // ë“œë˜ê·¸ ì´ë™ ê¸°ëŠ¥ ë¡œì§
        function initDraggable(el) {
            const handle = document.getElementById("dragHandle");
            let pos1 = 0, pos2 = 0, pos3 = 0, pos4 = 0;

            handle.onmousedown = dragMouseDown;

            function dragMouseDown(e) {
                e = e || window.event;
                // ì œëª© í‘œì‹œì¤„ ì˜ì—­ë§Œ ë“œë˜ê·¸ ê°€ëŠ¥í•˜ê²Œ ì„¤ì •
                if (e.target !== handle && e.target.parentNode !== handle) return;
                
                e.preventDefault();
                pos3 = e.clientX;
                pos4 = e.clientY;
                document.onmouseup = closeDragElement;
                document.onmousemove = elementDrag;
            }

            function elementDrag(e) {
                e = e || window.event;
                e.preventDefault();
                pos1 = pos3 - e.clientX;
                pos2 = pos4 - e.clientY;
                pos3 = e.clientX;
                pos4 = e.clientY;
                el.style.top = (el.offsetTop - pos2) + "px";
                el.style.left = (el.offsetLeft - pos1) + "px";
            }

            function closeDragElement() {
                document.onmouseup = null;
                document.onmousemove = null;
            }
        }

        // ë©”ëª¨ì¥ UI í† ê¸€ ë° ë°ì´í„° ë¡œë“œ (ìƒì† ë¡œì§)
        function toggleEditorUI(show, dateStr = "") {
            const wrapper = document.getElementById('editorWrapper');
            const dateText = document.getElementById('selectedDateText');

            if (show) {
                dateText.innerText = `${dateStr} ìš´ì˜ ì—…ë¬´`;
                wrapper.classList.add('show');
            } else { wrapper.classList.remove('show'); }
        }

        // ë©”ëª¨ ë¡œë“œ í•¨ìˆ˜ (ìƒì† ë¡œì§)
        function loadNoteForDate(dateStr) {
            if (!editorInstance) return;
            editorInstance.setData(''); // ë¡œë”© ì „ ë¹„ìš°ê¸° (ì”ìƒ ë°©ì§€)
            fetch(`get_work/?date=${dateStr}`) // ê¸°ì¡´ API ê²½ë¡œ ìœ ì§€
                .then(res => res.json())
                .then(data => { editorInstance.setData(data.content || ''); })
                .catch(() => { editorInstance.setData(''); });
        }

        // CKEditor ì´ˆê¸°í™”
        function initEditor() {
            const editorElement = document.querySelector('#editor');
            
            ClassicEditor.create(editorElement, {
                licenseKey: 'GPL', 
                toolbar: {
                    items: [
                        'heading', '|', 
                        'bold', 'italic', 'underline', 'strikethrough', 'highlight', '|',
                        'fontSize', 'fontColor', 'fontBackgroundColor', '|',
                        'bulletedList', 'numberedList', 'todoList', '|',
                        'code', 'codeBlock', 'blockQuote', 'insertTable', '|',
                        'link', 'undo', 'redo'
                    ],
                    shouldNotGroupWhenFull: true
                },
                // âœ… ë§í¬ ê¸°ëŠ¥ì´ í™•ì‹¤íˆ ë™ì‘í•˜ë„ë¡ ì„¤ì • ë³´ê°•
                link: {
                    addTargetToExternalLinks: true, // ì™¸ë¶€ ë§í¬ëŠ” ìƒˆ íƒ­ìœ¼ë¡œ
                    defaultProtocol: 'https://'
                },
                // âœ… ë²Œë£¬ íˆ´ë°”: í…ìŠ¤íŠ¸ ë“œë˜ê·¸ ì‹œ ë‚˜íƒ€ë‚˜ëŠ” í€µ íˆ´ë°”
                balloonToolbar: ['bold', 'italic', 'link', 'highlight'],
                highlight: {
                    options: [
                        { model: 'yellowMarker', class: 'pen-yellow', label: 'Yellow marker', type: 'marker' },
                        { model: 'greenMarker', class: 'pen-green', label: 'Green marker', type: 'marker' },
                        { model: 'pinkMarker', class: 'pen-pink', label: 'Pink marker', type: 'marker' },
                        { model: 'blueMarker', class: 'pen-blue', label: 'Blue marker', type: 'marker' },
                    ]
                }
            })
            .then(editor => {
                editorInstance = editor;
                
                // ì´ˆê¸° ë¡œë“œ ì‹œ ë§ˆì§€ë§‰ ë‚ ì§œ ë³µì›
                const lastDate = localStorage.getItem('last_selected_date');
                if (lastDate) {
                    selectedDate = lastDate;
                    calendar.setDate(lastDate, true);
                    toggleEditorUI(true, lastDate);
                    loadNoteForDate(lastDate);
                }
            })
            .catch(error => {
                console.error('ì—ë””í„° ì´ˆê¸°í™” ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
            });
        }
        // ì—ë””í„° ë°–ì„ í´ë¦­í–ˆê³ , ë‹¬ë ¥ ë‚ ì§œ í´ë¦­ì´ ì•„ë‹ ê²½ìš° ë‹«ê¸°
        document.addEventListener('mousedown', function(e) {
            const wrapper = document.getElementById('editorWrapper');
            if (wrapper.classList.contains('show') && 
                !wrapper.contains(e.target) && 
                !e.target.closest('.flatpickr-day')) {
                selectedDate = null;
                toggleEditorUI(false);
            }
        });

        // Flatpickr ì´ˆê¸°í™”
        calendar = flatpickr("#inlineCalendar", {
            inline: true, locale: "ko", dateFormat: "Y-m-d",
            onChange: function(selectedDates, dateStr) {
                if (selectedDate === dateStr) {
                    selectedDate = null; toggleEditorUI(false);
                } else {
                    selectedDate = dateStr;
                    localStorage.setItem('last_selected_date', dateStr);
                    toggleEditorUI(true, dateStr);
                    loadNoteForDate(dateStr);
                }
            }
        });

        // ì €ì¥ ë¡œì§ (ë¹ˆ ë©”ëª¨ ë°©ì§€)
        document.getElementById("noteForm").addEventListener("submit", function(e) {
            e.preventDefault();
            if (!selectedDate) return alert("ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”!");

            const content = editorInstance.getData();
            const plainText = content.replace(/<[^>]*>/g, '').replace(/&nbsp;/g, '').trim();

            if (!plainText) {
                alert("ë‚´ìš©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”. ë¹ˆ ë©”ëª¨ëŠ” ì €ì¥ ì‹œ ìƒì† ë¡œì§ì´ ëŠê¸¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
                return;
            }

            fetch('save_work/', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/x-www-form-urlencoded',
                    'X-CSRFToken': '{{ csrf_token }}'
                },
                body: new URLSearchParams({
                    date: selectedDate,
                    content: content
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    alert(selectedDate + " Save Complate");
                }
            });
        });

        // ë‹¤í¬ëª¨ë“œ ì—°ë™
        document.getElementById("dm").addEventListener("change", () => {
            document.body.classList.toggle("dark");
        });

        // ì´ˆê¸°í™” ì§„í–‰
        initEditor();
        // ë“œë˜ê·¸ ê¸°ëŠ¥ ì—°ê²°
        initDraggable(document.getElementById('editorWrapper'));
    </script>
</body>
</html>